<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OmniCredit — Төлбөрийн түүх</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/navigation.css">
  <link rel="stylesheet" href="css/buttons.css">
  <link rel="stylesheet" href="css/cards.css">
  <link rel="stylesheet" href="css/footer.css">

  <style>
    .page-header {
      margin: 48px 0 32px;
    }

    .filters {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .filter-select {
      padding: 10px 16px;
      border: 2px solid var(--line);
      border-radius: 999px;
      background: white;
      cursor: pointer;
      font-weight: 600;
    }

    .payment-list {
      max-width: 900px;
    }

    .payment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: var(--card);
      border-radius: var(--radius);
      margin-bottom: 12px;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }

    .payment-item:hover {
      box-shadow: var(--shadow);
    }

    .payment-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .payment-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }

    .payment-icon.success {
      background: #DFFFD8;
    }

    .payment-icon.pending {
      background: #FFE5D9;
    }

    .payment-icon.failed {
      background: #FFE5E5;
    }

    .payment-details h4 {
      margin-bottom: 4px;
      font-size: 1rem;
    }

    .payment-date {
      font-size: 13px;
      color: var(--text-muted);
    }

    .payment-amount {
      text-align: right;
    }

    .amount {
      font-weight: 800;
      font-size: 1.25rem;
      margin-bottom: 4px;
    }

    .amount.success {
      color: #10b981;
    }

    .amount.pending {
      color: var(--primary);
    }

    .amount.failed {
      color: #EF4444;
    }

    .payment-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 700;
    }

    .status-success {
      background: #DFFFD8;
      color: #10b981;
    }

    .status-pending {
      background: #FFE5D9;
      color: var(--primary);
    }

    .status-failed {
      background: #FFE5E5;
      color: #EF4444;
    }

    .summary-card {
      background: var(--gradient-peachy);
      color: white;
      padding: 32px;
      border-radius: var(--radius-lg);
      margin-bottom: 32px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-top: 24px;
    }

    .summary-item h4 {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .summary-item p {
      opacity: 0.9;
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .payment-item {
        flex-direction: column;
        align-items: start;
        gap: 16px;
      }

      .payment-amount {
        text-align: left;
        width: 100%;
      }

      .summary-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a href="index.html" class="brand">OmniCredit</a>
      <div class="nav-links">
        <a href="index.html">Нүүр</a>
        <a href="zeelhuudas.html">Зээлийн тооцоолуур</a>
        <a href="aboutus.html">Бидний тухай</a>
        <a href="FAQ.html">Түгээмэл асуулт</a>
        <a href="my-loans.html">Миний зээл</a>
      </div>
      <div class="auth-buttons">
        <a href="profile.html" class="btn btn-ghost btn-sm">Профайл</a>
        <a href="dashboard.html" class="btn btn-primary btn-sm">Dashboard</a>
      </div>
      <button class="mobile-menu-toggle">☰</button>
    </nav>

    <div class="page-header">
      <h1>Төлбөрийн түүх</h1>
      <p style="color: var(--text-muted);">Таны бүх төлбөрийн мэдээлэл</p>
    </div>

    <div class="summary-card">
      <h3 style="margin-bottom: 4px;">Нийт статистик</h3>
      <p style="opacity: 0.9; margin-bottom: 24px;"><span id="currentYear"></span> оны нэгдсэн тайлан</p>

      <div class="summary-grid">
        <div class="summary-item">
          <h4 id="totalPaid">₮0</h4>
          <p>Нийт төлсөн</p>
        </div>
        <div class="summary-item">
          <h4 id="paymentsCount">0</h4>
          <p>Гүйлгээний тоо</p>
        </div>
        <div class="summary-item">
          <h4 id="thisMonth">₮0</h4>
          <p>Энэ сар</p>
        </div>
      </div>
    </div>

    <div class="filters">
      <select class="filter-select">
        <option>Бүх гүйлгээ</option>
        <option>Амжилттай</option>
        <option>Хүлээгдэж буй</option>
        <option>Амжилтгүй</option>
      </select>

      <select class="filter-select">
        <option>Энэ сар</option>
        <option>Өнгөрсөн сар</option>
        <option>3 сар</option>
        <option>6 сар</option>
        <option>Энэ жил</option>
      </select>

      <button class="btn btn-secondary btn-sm" style="margin-left: auto;">
        Татаж авах
      </button>
    </div>

    <div class="payment-list" id="paymentList">
      <div style="text-align: center; padding: 48px;">
        <p style="color: var(--text-muted);">Төлбөрийн түүх уншиж байна...</p>
      </div>
    </div>

    <div id="noPaymentsMessage" style="display: none;">
      <div class="card" style="text-align: center; padding: 48px;">
        <div style="font-size: 64px; margin-bottom: 16px;"></div>
        <h3>Төлбөрийн түүх байхгүй</h3>
        <p style="color: var(--text-muted); margin: 16px 0;">
          Та одоогоор ямар ч төлбөр төлөөгүй байна
        </p>
      </div>
    </div>

    <div style="margin: 48px 0 80px;">
      <div class="card" style="padding: 48px; text-align: center;">
        <h3 style="margin-bottom: 16px;">Баримт хэрэгтэй юу?</h3>
        <p style="color: var(--text-muted); margin-bottom: 24px;">
          Төлбөрийн түүхийг PDF эсвэл Excel форматаар татаж авна уу
        </p>
        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
          <button class="btn btn-primary">PDF татах</button>
          <button class="btn btn-secondary">Excel татах</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="footer-brand">OmniCredit</div>
          <p>Монголын хамгийн хялбар бөгөөд найдвартай зээлийн үйлчилгээ.</p>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-copyright">
          <span>© 2025 OmniCredit. Бүх эрх хуулиар хамгаалагдсан.</span>
        </div>
      </div>
    </div>
  </footer>

<script src="js/navigation.js"></script>
<script src="js/auth-guard.js"></script>
  <script>
    // Set current year
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    // Load payment history
    async function loadPayments() {
      try {
        const payments = await PaymentsAPI.getMyPayments();

        const paymentList = document.getElementById('paymentList');
        const noPaymentsMessage = document.getElementById('noPaymentsMessage');

        if (!payments || payments.length === 0) {
          paymentList.style.display = 'none';
          noPaymentsMessage.style.display = 'block';
          return;
        }

        paymentList.innerHTML = payments.map(payment => {
          const date = new Date(payment.created_at);
          const formattedDate = date.toLocaleString('mn-MN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });

          const statusMap = {
            'completed': { label: 'АМЖИЛТТАЙ', class: 'status-success', icon: '' },
            'pending': { label: 'ХҮЛЭЭГДЭЖ БУЙ', class: 'status-pending', icon: '' },
            'failed': { label: 'АМЖИЛТГҮЙ', class: 'status-failed', icon: '' }
          };

          const status = statusMap[payment.status] || statusMap['pending'];

          return `
            <div class="payment-item">
              <div class="payment-info">
                <div class="payment-icon ${payment.status}">${status.icon}</div>
                <div class="payment-details">
                  <h4>Төлбөр #${payment.id} - Зээл #${payment.loan_id}</h4>
                  <div class="payment-date">${formattedDate}</div>
                </div>
              </div>
              <div class="payment-amount">
                <div class="amount ${payment.status}">-₮${payment.amount.toLocaleString()}</div>
                <span class="payment-status ${status.class}">${status.label}</span>
              </div>
            </div>
          `;
        }).join('');

        // Calculate summary stats from payments
        const totalPaid = payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
        const paymentsCount = payments.length;

        // Calculate this month's payments
        const now = new Date();
        const thisMonthPayments = payments.filter(p => {
          const paymentDate = new Date(p.payment_date || p.created_at);
          return paymentDate.getMonth() === now.getMonth() &&
                 paymentDate.getFullYear() === now.getFullYear();
        });
        const thisMonthTotal = thisMonthPayments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);

        // Update summary
        document.getElementById('totalPaid').textContent = `₮${totalPaid.toLocaleString()}`;
        document.getElementById('paymentsCount').textContent = paymentsCount;
        document.getElementById('thisMonth').textContent = `₮${thisMonthTotal.toLocaleString()}`;

      } catch (error) {
        console.error('Load payments error:', error);
        document.getElementById('paymentList').innerHTML = `
          <div style="text-align: center; padding: 48px;">
            <p style="color: var(--text-muted);">Төлбөрийн түүх уншихад алдаа гарлаа</p>
          </div>
        `;
      }
    }

    // Load payments when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadPayments);
    } else {
      loadPayments();
    }
  </script>
  <!-- Main Application - Component Based -->
  <script type="module" src="main.js"></script>
</body>
</html>